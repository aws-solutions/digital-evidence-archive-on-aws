openapi: '3.0.0'
info:
  version: 1.0.0
  title: DEA Case API
paths:
  /admin/cases:
    get:
      summary: admin-only get all cases
      description: returns array of cases
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cases'
  /config:
    put:
      summary: Put storage config
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageConfig'
      responses:
        200:
          description: Storage config successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageConfig'
    get:
      summary: Get storage config
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageConfig'
  /cases:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCaseObject'
      responses:
        200:
          description: Case successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
  /cases/{caseId}/userMemberships:
    post:
      summary: Add a user as a collaborator to a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseUserRequest'
      responses:
        200:
          description: Case successfully created
          content:
            application/json:
              schema:
                properties:
                  userId:
                    type: string
                  caseId:
                    type: string
    get:
      summary: Get all users by case
      description: get all users with membership on a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
  /cases/{caseId}/userMemberships/{userId}:
    put:
      summary: Update case user
      description: Update the details on an existing case membership
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
        - in: path
          name: userId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseUserRequest'
      responses:
        200:
          description: Case successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaseUserRequest'
    delete:
      summary: Remove case user
      description: Remove a collaborator from a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
        - in: path
          name: userId
          schema:
            type: string
          required: true
      responses:
        204:
          description: No content, delete successful
  /cases/{caseId}/owner:
    post:
      summary: Add a user as a collaborator to a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                caseId:
                  type: string
                actions:
                  type: array
                  items:
                    $ref: '#/components/schemas/CaseAction'
                isOwner:
                  type: boolean
                  default: true
      responses:
        200:
          description: Case successfully created
          content:
            application/json:
              schema:
                properties:
                  userId:
                    type: string
                  caseId:
                    type: string
  /my-cases:
    get:
      summary: get user's cases
      description: returns array of cases on which the user has membership
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cases'
  /cases/{caseId}:
    get:
      summary: Return case details by case Id
      description: Get metadata for a specific case. return not found if user doesn’t have access
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
    put:
      summary: Update case details
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseRequest'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
  /cases/{caseId}/status:
    put:
      summary: Update case status
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseStatusRequest'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
        304:
          description: unchanged status
  /cases/{caseId}/files:
    post:
      summary: Upload files to a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CaseFiles'
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaseUploadResponse'
    get:
      summary: Return case details by case Id
      description: Get metadata for a specific case. return not found if user doesn’t have access
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
        - in: query
          name: parentId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Case'
  /cases/{caseId}/files/{fileId}:
    get:
      summary: File details
      description: Get details for a file within a case
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
        - in: path
          name: fileId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  caseId:
                    type: string
                  file:
                    $ref: '#/components/schemas/CaseFile'
  /cases/{caseId}/files/{fileId}/contents:
    get:
      summary: Download file
      description: Download the contents of a file via s3 signed url
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
        - in: path
          name: fileId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  caseId:
                    type: string
                  fileContents_presignedUrl:
                    type: string
                    format: uri
  /users/{caseId}:
    get:
      summary: Get users by caseId
      parameters:
        - in: path
          name: caseId
          schema:
            type: string
          required: true
      responses:
        200:
          description: Success Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
components:
  schemas:
    Case:
      type: object
      properties:
        caseId:
          type: string
        caseName:
          type: string
        caseDescription:
          type: string
        createDate:
          type: string
        lastUpdateDate:
          type: string
        objectCount:
          type: number
        status:
          $ref: '#/components/schemas/CaseStatus'
    Cases:
      type: array
      items:
        $ref: '#/components/schemas/Case'
    CaseRequest:
      type: object
      properties:
        caseId:
          type: string
        caseName:
          type: string
        caseDescription:
          type: string
    CaseStatusRequest:
      type: object
      properties:
        caseId:
          type: string
        caseStatus:
          $ref: '#/components/schemas/CaseStatus'
    CreateCaseObject:
      type: object
      properties:
        CaseName:
          type: string
          example: Cookie Stealing
        CaseDescription:
          type: string
          example: Suspecting cookie monster stole all the cookies
    CaseUser:
      type: object
      properties:
        userId:
          type: string
        caseId:
          type: string
        actions:
          type: array
          items:
            $ref: '#/components/schemas/CaseAction'
        caseName:
          type: string
        firstName:
          type: string
        lastName:
          type: string
    CaseUserRequest:
      type: object
      properties:
        userId:
          type: string
        caseId:
          type: string
        actions:
          type: array
          items:
            $ref: '#/components/schemas/CaseAction'
        isOwner:
          type: boolean
    CaseFile:
      type: object
      properties:
        name:
          type: string
        preceedingDirectoryUlid:
          type: string
        ulid:
          type: string
        isFile:
          type: boolean
        contentPath:
          type: string
    CaseFiles:
      type: array
      items:
        $ref: '#/components/schemas/CaseFile'
    CaseUploadResponse:
      type: object
      properties:
        caseId:
          type: string
        uploadUrls:
          type: array
          items:
            type: string
            format: uri
    User:
      type: object
      properties:
        ulid:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        lowerFirstName:
          type: string
        lowerLastName:
          type: string
    Users:
      type: array
      items:
        $ref: '#/components/schemas/User'
    StorageConfig:
      type: object
      properties:
        ActiveStorage:
          $ref: '#/components/schemas/StorageTier'
        ArchiveStorage:
          $ref: '#/components/schemas/StorageTier'

    CaseAction:
      type: string
      enum: [VIEW_CASE_DETAILS, UPLOAD, DOWNLOAD, ARCHIVE, RESTORE, VIEW_FILES, CASE_AUDIT, INVITE, OWN]
    CaseStatus:
      type: string
      enum: [ACTIVE, ARCHIVE, DELETED]
    StorageTier:
      type: string
      enum: [S3STANDARD, GLACIER_INSTANT, GLACIER_FLEX, GLACIER_DEEP]
